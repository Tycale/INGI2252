% LINGI2252 - Measures & Maintenance
% Code Analysis
\documentclass[11pt, a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[UKenglish]{babel}
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
\usepackage{xcolor}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{array}
\usepackage{longtable}
\usepackage{multirow}


\lstset{%
	basicstyle=\ttfamily\footnotesize,
	commentstyle=\color{green!90!black},
%	frame=single,
	keywordstyle=\bfseries\color{blue},
	language=python,
	numberstyle=\color{gray},
%	tabsize=2,
}


\hypersetup{%
	colorlinks=true,
	linkcolor=blue,
	urlcolor=blue
}


\newcommand{\tbf}[1]{\textbf{#1}}
\newcommand{\tit}[1]{\textit{#1}}

\newcommand{\pyl}{\textsf{Pylint}}


\title{\tbf{UCL} \\
	LINGI2252 - Measures \& Maintenance}
\author{Group 23 \\
		Thibault Gerondal \& Michael Heraly \\
		\\
		\tit{Teacher: Kim Mens}}
%\date{}							% Activate to display a given date or no date


\begin{document}
\maketitle


\section*{Presentation of Reddit}

Reddit is a popular social networking service that allows its members to share content as text posts or links.
Members can vote ``up'' or ``down'' on a content to promote it to other members.
The content is organized in subcategories, called \tit{subreddits}.
Reddit is an open-source project, and its code is available on Github\footnote{\url{https://github.com/reddit/reddit}}.


\section{Methodology}

After installing Reddit and its dependencies\footnote{\url{https://github.com/reddit/reddit/wiki/Install-guide}}, we have run \pyl{} on the source code.
We used the \tit{parseable} output feature that \pyl{} offers, and created a script to create a CVS file format from the parseable file.
This way, we created a spreadsheet containing the informations about errors/warnings/refactors detected by \pyl{}: the file concerned, at which line, code of the error, and the message associated.
This was a practical help to analyse the \pyl{} output, and compute the statistics.


\section{Type of errors}

\begin{longtable}{|c|c|r|m{9.2cm}|}
\hline
\textbf{\small{Error}} & \textbf{\small{Occ\footnote{Number of occurences}}} & \textbf{\small{RFP\footnote{Rate of false positive(s)}}} & \textbf{\small{Message}} \\
\hline
\hline
E1101 & 225 & 17.78\% & Used when an object (variable, function, \dots) is accessed for a non-existent member. \\
\hline
W0201 & 144 & 0.00\% &  \\
\hline
W0613 & 98 & 0.00\% &  \\
\hline
W0612 & 91 & 8.79\% &  \\
\hline
R0913 & 91 & 8.79\% &  \\
\hline
W0621 & 88 & 9.09\% &  \\
\hline
E0611 & 49 & 0.00\% &  \\
\hline
R0914 & 49 & 4.08\% &  \\
\hline
W0622 & 40 & 2.50\% &  \\
\hline
W0231 & 38 & 2.63\% &  \\
\hline
C0324 & 34 & 0.00\% &  \\
\hline
W0311 & 27 & 0.00\% &  \\
\hline
C0321 & 26 & 3.85\% &  \\
\hline
R0902 & 24 & 4.17\% &  \\
\hline
W0221 & 23 & 0.00\% &  \\
\hline
W0403 & 22 & 0.00\% &  \\
\hline
E0602 & 21 & 80.95\% &  \\
\hline
W0232 & 21 & 19.05\% &  \\
\hline
W0102 & 20 & 0.00\% &  \\
\hline
R0911 & 12 & 0.00\% &  \\
\hline
W0404 & 10 & 0.00\% &  \\
\hline
R0904 & 9 & 22.22\% &  \\
\hline
W0233 & 8 & 0.00\% &  \\
\hline
W0702 & 8 & 0.00\% &  \\
\hline
E0211 & 7 & 100.00\% &  \\
\hline
C0203 & 7 & 0.00\% &  \\
\hline
E1123 & 6 & 83.33\% &  \\
\hline
C0322 & 6 & 0.00\% &  \\
\hline
C0202 & 5 & 0.00\% &  \\
\hline
W0105 & 5 & 0.00\% &  \\
\hline
R0912 & 5 & 0.00\% &  \\
\hline
E1120 & 4 & 0.00\% &  \\
\hline
E0213 & 4 & 0.00\% &  \\
\hline
W0631 & 4 & 50.00\% &  \\
\hline
E0710 & 3 & 0.00\% &  \\
\hline
W0703 & 3 & 0.00\% &  \\
\hline
F0401 & 2 & 50.00\% &  \\
\hline
W0106 & 2 & 0.00\% &  \\
\hline
R0901 & 2 & 0.00\% &  \\
\hline
W0602 & 2 & 100.00\% &  \\
\hline
E1002 & 1 & 100.00\% &  \\
\hline
W0122 & 1 & 100.00\% &  \\
\hline
E0702 & 1 & 100.00\% &  \\
\hline
W0101 & 1 & 0.00\% &  \\
\hline
E0711 & 1 & 0.00\% &  \\
\hline
W0701 & 1 & 0.00\% &  \\
\hline
E0102 & 1 & 0.00\% &  \\
\hline
E0101 & 1 & 0.00\% &  \\
\hline
E0203 & 1 & 100.00\% &  \\
\hline
\end{longtable}


\section{Statistics}

\subsection*{Precision}

We computed the precision on all the errors/warnings given by \pyl{}.
We checked the source code to determine if these were true or false-positives.
This way, we can have a good idea of the precision of \pyl{}.

We have computed the precision for each category of the informations given by \pyl{}.


\subsection*{Recall}

As the project is too big to be analysed in details, we have selected 2 files to compute the \tit{recall} statistic.


\section{Bad things}

\hrulefill
\begin{lstlisting}[caption=3 nested for-loops - 2 times in a row - in a single function]
for campaign in all_campaigns:
    camp_dates = set(get_date_range(campaign.start_date, \
					campaign.end_date))
    sr_names = tuple(sorted(campaign.target.subreddit_names))
    daily_impressions = campaign.impressions / campaign.ndays

    for location in locations:
        if location and not location.contains(campaign.location):
            # campaign's location is less specific than location
            continue

        for date in camp_dates.intersection(dates):
            booked_dict[date][location][sr_names] += daily_impressions

    # calculate inventory for each target and location on each date
    datekey = lambda dt: dt.strftime('%m/%d/%Y') if datestr else dt

ret = {}
for target in targets:
    name = make_target_name(target)
    subreddit_names = target.subreddit_names
    ret[name] = {}
    for date in dates:
        pageviews_by_location = {}
        for location in locations:
            # calculate available impressions for each location
            booked_by_target = booked_dict[date][location]
            pageviews_by_sr_name = pageviews_dict[location]
            pageviews_by_location[location] = get_maximized_pageviews(
                subreddit_names, booked_by_target, pageviews_by_sr_name)
        # available pageviews is the minimum from all locations
        min_pageviews = min(pageviews_by_location.values())
        ret[name][datekey(date)] = max(0, min_pageviews)
\end{lstlisting}
\hrulefill


\end{document}

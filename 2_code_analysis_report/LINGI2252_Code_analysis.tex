% LINGI2252 - Measures & Maintenance
% Code Analysis
\documentclass[11pt, a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[UKenglish]{babel}
\usepackage{graphicx}				% Use pdf, png, jpg, or epsÂ§ with pdflatex; use eps in DVI mode
\usepackage{xcolor}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{array}
\usepackage{longtable}
\usepackage{multirow}
\usepackage[babel=true]{csquotes}

\lstset{%
	basicstyle=\ttfamily\footnotesize,
	commentstyle=\color{green!90!black},
%	frame=single,
	keywordstyle=\bfseries\color{blue},
	language=python,
	numberstyle=\color{gray},
%	tabsize=2,
}


\hypersetup{%
	colorlinks=true,
	linkcolor=blue,
	urlcolor=blue
}


\newcommand{\tbf}[1]{\textbf{#1}}
\newcommand{\tit}[1]{\textit{#1}}

\newcommand{\pyl}{\textsf{Pylint}}


\title{\tbf{UCL} \\
	LINGI2252 - Measures \& Maintenance}
\author{Group 23 \\
		Thibault Gerondal \& Michael Heraly \\
		\\
		\tit{Teacher: Kim Mens}}
%\date{}							% Activate to display a given date or no date


\begin{document}
\maketitle


\section*{Presentation of Reddit}

Reddit is a popular social networking service that allows its members to share content as text posts or links.
Members can vote ``up'' or ``down'' on a content to promote it to other members.
The content is organized in subcategories, called \tit{subreddits}.
Reddit is an open-source project, and its code is available on Github\footnote{\url{https://github.com/reddit/reddit}}.


\section{Methodology}

After installing Reddit and its dependencies\footnote{\url{https://github.com/reddit/reddit/wiki/Install-guide}}, we have run \pyl{} on the source code.
We used the \tit{parseable} output feature that \pyl{} offers, and created a script to create a CVS file format from the parseable file.
This way, we created a spreadsheet containing the informations about errors/warnings/refactors/conventions/fatal detected by \pyl{}: the file concerned, at which line, code of the error, and the message associated. This was a practical help to analyse the \pyl{} output, and compute the statistics.

\newpage
\section{Type of errors}

\begin{longtable}{|l|c|r|m{9.2cm}|}
\hline
\textbf{\small{Error}} & \textbf{\small{Occ\footnote{Number of occurences}}} & \textbf{\small{RFP\footnote{Rate of false positive(s)}}} & \textbf{\small{Message}} \\
\hline
\hline
E1101 & 225 & 17.78\% & An object (variable, function, \dots) is accessed for a non-existent member. \\
\hline
W0201 & 144 & 0.00\% & Attribute X defined outside \_\_init\_\_ \\
\hline
W0613 & 98 & 0.00\% & Unused argument X \\
\hline
W0612 & 91 & 8.79\% & Unused variable X \\
\hline
R0913 & 91 & 8.79\% & Too many arguments X \\
\hline
W0621 & 88 & 9.09\% & Redefining name X from outer scope \\
\hline
E0611 & 49 & 0.00\% & No name X in module Y \\
\hline
R0914 & 49 & 4.08\% & Too many local variables \\
\hline
W0622 & 40 & 2.50\% & Redefining built-in X \\
\hline
W0231 & 38 & 2.63\% & \_\_init\_\_ method from base class X is not called \\
\hline
C0324 & 34 & 0.00\% & Comma not followed by a space \\
\hline
W0311 & 27 & 0.00\% & Bad indentation \\
\hline
C0321 & 26 & 3.85\% & More than one statement on a single line \\
\hline
R0902 & 24 & 4.17\% & Too many instance attributes \\
\hline
W0221 & 23 & 0.00\% & Arguments number differs from X method \\
\hline
W0403 & 22 & 0.00\% & Relative import X, should be Y \\
\hline
E0602 & 21 & 80.95\% & Undefined variable X \\
\hline
W0232 & 21 & 19.05\% & Class has no \_\_init\_\_ method \\
\hline
W0102 & 20 & 0.00\% & Dangerous default value X as argument \\
\hline
R0911 & 12 & 0.00\% & Too many return statements \\
\hline
W0404 & 10 & 0.00\% & Reimport X \\
\hline
R0904 & 9 & 22.22\% & Too many public methods \\
\hline
W0233 & 8 & 0.00\% & \_\_init\_\_ method from a non direct base class X is called \\
\hline
W0702 & 8 & 0.00\% & No exception type(s) specified \\
\hline
E0211 & 7 & 100.00\% & Method has no argument \\
\hline
C0203 & 7 & 0.00\% & Metaclass method X should have mcs as first argument \\
\hline
E1123 & 6 & 83.33\% & Passing unexpected keyword argument X in function call \\
\hline
C0322 & 6 & 0.00\% & Operator not preceded by a space \\
\hline
C0202 & 5 & 0.00\% & Class method X should have cls as first argument \\
\hline
W0105 & 5 & 0.00\% & String statement has no effect \\
\hline
R0912 & 5 & 0.00\% & Too many branches \\
\hline
E1120 & 4 & 0.00\% & No value passed for parameter X in function call \\
\hline
E0213 & 4 & 0.00\% & Method should have \enquote{self} as first argument \\
\hline
W0631 & 4 & 50.00\% & Using possibly undefined loop variable X \\
\hline
E0710 & 3 & 0.00\% & Raising a new style class which doesn't inherit from BaseException \\
\hline
W0703 & 3 & 0.00\% & Catching too general exception X \\
\hline
F0401 & 2 & 50.00\% & Unable to import X \\
\hline
W0106 & 2 & 0.00\% & Expression X is assigned to nothing \\
\hline
R0901 & 2 & 0.00\% & Too many ancestors \\
\hline
W0602 & 2 & 100.00\% & Using global for X but no assigment is done \\
\hline
E1002 & 1 & 100.00\% & Use of super on an old style class \\
\hline
W0122 & 1 & 100.00\% & Use of exec \\
\hline
E0702 & 1 & 100.00\% & Raising X while only classes, instances or string are allowed \\
\hline
W0101 & 1 & 0.00\% & Unreachable code \\
\hline
E0711 & 1 & 0.00\% & NotImplemented raised - should raise NotImplementedError \\
\hline
W0701 & 1 & 0.00\% & Raising a string exception \\
\hline
E0102 & 1 & 0.00\% & X already defined line Y \\
\hline
E0101 & 1 & 0.00\% & Explicit return in \_\_init\_\_ \\
\hline
E0203 & 1 & 100.00\% & Access to member X before its definition line Y \\
\hline
\caption{\label{messages} Analyzed messages}
\end{longtable}


\section{Statistics}

\subsection*{Precision}


We checked the source code to determine if these were true or false-positives. We computed the precision on all the messages given by \pyl{} (as seen in Table~\ref{messages}). This way, we can have a good idea of the precision of \pyl{}.\\

We have computed the precision for each category of the informations given by \pyl{} :

\begin{longtable}{|l|c|r|m{9.2cm}|}
\hline
\textbf{\small{}} & \textbf{\small{Precision}} & \textbf{\small{Messages analyzed}} \\
\hline
\hline
Precision on Warning & 95.89\% & 657 \\
Precision on Error & 77.84\% & 325 \\
Precision on Refactoring & 93.22\% & 192 \\
Precision on Convention & 98.71\% & 78 \\
Precision on Fatal & 50\% & 2 \\
\hline
Precision Total & 90.9\% & 1254 \\
\hline
\end{longtable}

As we can see, \pyl{} is really good at detecting conventions, refactoring and warning issues and is a little bit less accurate for advices about errors. \\

Fatal happens if an error occurred which prevented \pyl{} from doing further processing. We got two \enquote{unable to import X} in our case because these modules are not mandatory to run Reddit.

\subsection*{Recall}

As the project is too big to be analysed in details, we have selected 5 random files to compute the \tit{recall} statistic. \\

We didn't manage to find much more than Pylint did. In \texttt{r2/lib/base.py}, the following errors was not reported :

\begin{lstlisting}[caption= 3 useless functions]
def try_pagecache(self):
    pass
def pre(self): pass
def post(self): pass
\end{lstlisting}

\pyl{} could generates three errors for these functions but didn't.


Another file analysed is \texttt{r2/lib/authorize/interaction.py} :

\begin{lstlisting}[caption= test data in the file..]
# useful test data:
test_card = dict(AMEX       = ("370000000000002"  , 1234),
                 DISCOVER   = ("6011000000000012" , 123),
                 MASTERCARD = ("5424000000000015" , 123),
                 VISA       = ("4007000000027"    , 123),
                 # visa card which generates error codes based on the amount
                 ERRORCARD  = ("4222222222222"    , 123))

test_card = Storage((k, CreditCard(cardNumber=x,
                                   expirationDate="2011-11",
                                   cardCode=y)) for k, (x, y) in
                    test_card.iteritems())

test_address = Address(firstName="John",
                       lastName="Doe",
                       address="123 Fake St.",
                       city="Anytown",
                       state="MN",
                       zip="12346")
\end{lstlisting}

These datas are not used in the code at all. It looks like testing rest that the developer used.

In the three others files, we didn't found any remarques to say.


\section{Bad things}

\hrulefill
\begin{lstlisting}[caption=3 nested for-loops - 2 times in a row - in a single function]
for campaign in all_campaigns:
    camp_dates = set(get_date_range(campaign.start_date, \
					campaign.end_date))
    sr_names = tuple(sorted(campaign.target.subreddit_names))
    daily_impressions = campaign.impressions / campaign.ndays

    for location in locations:
        if location and not location.contains(campaign.location):
            # campaign's location is less specific than location
            continue

        for date in camp_dates.intersection(dates):
            booked_dict[date][location][sr_names] += daily_impressions

    # calculate inventory for each target and location on each date
    datekey = lambda dt: dt.strftime('%m/%d/%Y') if datestr else dt

ret = {}
for target in targets:
    name = make_target_name(target)
    subreddit_names = target.subreddit_names
    ret[name] = {}
    for date in dates:
        pageviews_by_location = {}
        for location in locations:
            # calculate available impressions for each location
            booked_by_target = booked_dict[date][location]
            pageviews_by_sr_name = pageviews_dict[location]
            pageviews_by_location[location] = get_maximized_pageviews(
                subreddit_names, booked_by_target, pageviews_by_sr_name)
        # available pageviews is the minimum from all locations
        min_pageviews = min(pageviews_by_location.values())
        ret[name][datekey(date)] = max(0, min_pageviews)
\end{lstlisting}
\hrulefill


\end{document}
